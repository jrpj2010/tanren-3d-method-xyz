### 1. はじめに

#### 1.1. プロジェクトの目的
本ドキュメントは、「Kindleハイライト自動連携Webアプリケーション」開発プロジェクトの工程、スケジュール、体制、リスク管理などを定義し、プロジェクトを円滑に推進することを目的とします。

#### 1.2. プロジェクトのスコープ
要件定義書に記載された機能要件および非機能要件を満たすWebアプリケーションの開発、テスト、リリースまでをスコープとします。リリース後の本格的な運用・保守フェーズの詳細は別途定義します。

### 2. プロジェクト体制

| 役割               | 担当者/チーム（例） | 主要な責務                                                                 |
| ------------------ | ----------------- | ------------------------------------------------------------------------ |
| プロジェクトマネージャー | [担当者名]        | プロジェクト全体の進捗管理、課題管理、リスク管理、コミュニケーション、品質管理。                       |
| テックリード/アーキテクト | [担当者名]        | 技術選定、アーキテクチャ設計、技術的課題の解決、コードレビュー。                                 |
| バックエンド開発チーム | [チームメンバー]    | APIサーバー、認証、データ抽出、Markdown生成、Google Drive連携、データベース設計・実装。                |
| フロントエンド開発チーム | [チームメンバー]    | ユーザーインターフェースの設計・実装。                                                     |
| QAエンジニア        | [担当者名]        | テスト計画の策定、テストケース作成、テスト実施、バグ報告と追跡。                                   |
| （任意）UI/UXデザイナー | [担当者名]        | ユーザーインターフェースのデザイン、ユーザビリティの検証・改善提案。                                 |

### 3. 開発プロセス・方法論

本プロジェクトでは、**アジャイル開発方法論（スクラム）** を採用します。
*   **イテレーション（スプリント）:** 2週間を1スプリントとする。
*   **主要イベント:**
    *   スプリントプランニング
    *   デイリースクラム
    *   スプリントレビュー
    *   スプリントレトロスペクティブ
*   **バックログ管理:** プロダクトバックログ、スプリントバックログを使用し、優先順位に基づいて開発を進める。
*   **ツール:** JIRA, Trello, Asanaなどのプロジェクト管理ツール、GitHub/GitLabなどのバージョン管理システムを使用。
*   **開発環境:** ローカル開発環境ではDockerコンテナを利用し、本番環境との整合性を高めます。Google Cloud Runへのデプロイを前提とした開発を行います。

### 4. WBS (Work Breakdown Structure) - 詳細タスクリスト

#### 4.1. プロジェクトセットアップ
*   プロジェクト構成の決定（Next.js + TypeScript, Docker, Google Cloud Run）
*   Dockerベースの開発環境のセットアップ
    *   `Dockerfile`の作成と最適化
    *   `.dockerignore`ファイルの作成
    *   （オプション）`docker-compose.yml` फॉर ローカル開発の簡略化
*   必要なライブラリとパッケージのインストール（コンテナ内）
    *   UI: shadcn/ui, Tailwind CSS
    *   スクレイピング: Puppeteer/Playwright
    *   API: Google Drive API クライアント
    *   データベース: Prisma ORM
*   環境変数の設定（.envファイル管理とCloud Runでの設定方法の確立）
*   GitHubリポジトリの作成とCI/CDパイプラインの設定
    *   DockerイメージのビルドとGoogle Artifact Registry（または他のコンテナリポジトリ）へのプッシュ
    *   Google Cloud Runへの自動デプロイ設定

#### 4.2. 認証システム
*   NextAuth.jsのセットアップ
*   ユーザー登録機能の実装
*   ログイン/ログアウト機能の実装
*   パスワードリセット機能の実装
*   Amazon OAuth連携の調査と実装
    *   Amazon認証情報の安全な保存方法の検討
*   Google OAuth連携の実装
    *   Google Drive APIのスコープ設定

#### 4.3. データベース設計と実装
*   データベーススキーマの設計
    *   ユーザーテーブル
    *   認証情報テーブル（Amazon、Google）
    *   書籍テーブル
    *   ハイライトテーブル
    *   同期履歴テーブル
    *   設定テーブル
*   Prismaスキーマの作成
*   マイグレーションスクリプトの作成
*   シードデータの作成（開発用）

#### 4.4. バックエンドAPI
*   RESTful APIエンドポイントの設計
*   ユーザー管理APIの実装
*   書籍データ管理APIの実装
*   ハイライト管理APIの実装
*   同期履歴APIの実装
*   設定管理APIの実装
*   APIのエラーハンドリングとバリデーション
*   APIのドキュメント作成

#### 4.5. Kindleスクレイピング機能
*   Amazonログインプロセスの分析
*   Kindle Cloud Readerへのアクセス方法の調査
*   Puppeteer/Playwrightを使用したスクレイピングモジュールの実装
    *   ログイン処理
    *   書籍一覧の取得
    *   各書籍のハイライトとメモの抽出
*   スクレイピングデータの構造化
*   エラーハンドリングと再試行メカニズム
*   CAPTCHAやIP制限対策の検討
*   スクレイピングの最適化（増分更新など）

#### 4.6. Google Drive連携
*   Google Drive APIの調査と設計
*   フォルダ作成・検索機能の実装
*   Markdownファイル生成機能の実装
    *   テンプレートエンジンの実装
    *   カスタマイズ可能なフォーマット
*   ファイル保存・更新機能の実装
*   ファイル一覧取得機能の実装
*   ファイル内容取得機能の実装
*   エラーハンドリングとリトライメカニズム

#### 4.7. 同期スケジューラ
*   同期処理のコアロジック実装
    *   Kindleデータ取得
    *   差分検出
    *   Markdownファイル生成
    *   Google Driveへの保存
*   定期実行スケジューラの実装
    *   Cronジョブの設定
    *   同期頻度の設定機能
*   手動同期トリガーの実装
*   同期状態の監視と通知機能
*   同期履歴の記録
*   同期エラーのハンドリングと再試行

#### 4.8. フロントエンド実装
*   共通コンポーネントの実装
    *   ヘッダー
    *   フッター
    *   ナビゲーション
    *   認証フォーム
*   各画面の実装
    *   ホーム/ランディングページ
    *   ログイン/登録画面
    *   オンボーディング画面
    *   ダッシュボード
    *   書籍一覧画面
    *   書籍詳細画面
    *   ハイライト一覧画面
    *   設定画面
    *   プロフィール画面
    *   同期履歴画面
*   状態管理の実装（React Context/Redux）
*   API連携の実装
*   レスポンシブデザインの調整
*   アクセシビリティ対応
*   ダークモード対応

#### 4.9. テストとデバッグ
*   ユニットテストの作成
    *   バックエンドAPI
    *   スクレイピングモジュール
    *   Google Drive連携
*   統合テストの作成
*   E2Eテストの作成
*   パフォーマンステスト
*   セキュリティテスト
    *   認証情報の保護
    *   APIのセキュリティ
*   クロスブラウザテスト
*   モバイル対応テスト

#### 4.10. デプロイと運用
*   Google Cloud Run環境の準備
    *   サービスアカウントと権限設定
    *   必要なAPI（例: Google Drive API）の有効化
*   CI/CDパイプラインの構築とテスト
    *   Dockerイメージビルドプロセスの確立
    *   コンテナリポジトリへのプッシュ自動化
    *   `gcloud`コマンドを利用したCloud Runへのデプロイスクリプト作成と自動化
*   監視とロギングの設定 (Google Cloud Logging, Google Cloud Monitoringの活用)
    *   エラー監視
    *   パフォーマンス監視
*   バックアップ戦略の実装（Google Drive内のデータ保全を主とする）
*   スケーリング計画の策定（Cloud Runの自動スケーリング設定の理解と最適化）
*   メンテナンス計画の策定

#### 4.11. ドキュメントと補助資料
*   API仕様書の作成
*   データベース設計書の作成
*   アーキテクチャ図の作成
*   ユーザーマニュアルの作成
*   開発者ドキュメントの作成
*   トラブルシューティングガイドの作成

#### 4.12. 追加機能（優先度低）
*   ハイライトの検索機能
*   ハイライトのタグ付け機能
*   AIによるハイライト分析機能
*   複数のGoogle Driveアカウント対応
*   エクスポート機能（PDF、HTMLなど）
*   共有機能
*   モバイルアプリ対応

### 5. マイルストーンと実装フェーズ計画

#### フェーズ1: 基盤構築（4週間）
*   プロジェクトセットアップ (4.1) - **Docker環境構築、Cloud Runデプロイ雛形作成を含む**
*   認証システム (4.2)
*   データベース設計と実装 (4.3)
*   基本的なフロントエンド（認証画面、ダッシュボード） (4.8の一部)

#### フェーズ2: コア機能実装（6週間）
*   Kindleスクレイピング機能 (4.5)
*   Google Drive連携 (4.6)
*   同期処理の基本実装 (4.7の一部)
*   書籍・ハイライト表示機能 (4.8の一部)

#### フェーズ3: 完成と最適化（4週間）
*   同期スケジューラ (4.7の残り)
*   残りのフロントエンド画面 (4.8の残り)
*   テストとデバッグ (4.9)
*   パフォーマンス最適化

#### フェーズ4: デプロイと運用準備（2週間）
*   デプロイと運用 (4.10) - **Google Cloud Runへの本番デプロイメントプロセスの確立**
*   ドキュメントと補助資料 (4.11)
*   ユーザーフィードバックの収集と改善準備

*この実装計画は、プロジェクトの進行に応じて調整が必要になる場合があります。各タスクの依存関係を考慮しながら、優先順位を決めて進めることが重要です。*

### 6. マイルストーンとスケジュール（例）

| マイルストーン                     | 完了予定日（目安） | 成果物                                     |
| ---------------------------------- | ----------------- | ---------------------------------------- |
| M1: 計画・設計完了                  | プロジェクト開始後4週間 | 詳細設計書、UIプロトタイプ、テスト計画書、**初期Dockerセットアップ、Cloud Run疎通確認**        |
| M2: コア機能プロトタイプ完成          | プロジェクト開始後12週間 | 基本的な同期機能が動作するプロトタイプ **(コンテナ上で動作)**        |
| M3: 全機能実装完了 (α版)           | プロジェクト開始後18週間 | 全機能が実装され、内部テスト可能なバージョン **(Cloud Runステージング環境でテスト)**    |
| M4: 品質保証完了 (β版/RC版)         | プロジェクト開始後22週間 | テスト完了、リリース候補バージョン          |
| M5: 本番リリース                    | プロジェクト開始後24週間 | Webアプリケーション本番稼働 **(Google Cloud Run上)**               |

*上記はあくまで目安であり、チームの規模や進捗により変動します。各スプリントの成果を元に見直します。*

### 7. リソース計画

*   **人員:** 上記「2. プロジェクト体制」に記載のメンバー。必要に応じて外部リソースの活用も検討。
*   **ツール:**
    *   プロジェクト管理ツール (JIRA, Trello等)
    *   バージョン管理システム (GitHub, GitLab等)
    *   コミュニケーションツール (Slack, Microsoft Teams等)
    *   ドキュメント共有ツール (Confluence, Google Workspace等)
    *   開発IDE、テストツール
    *   クラウドプラットフォーム利用料 (開発・ステージング・本番環境)

### 8. コミュニケーション計画

*   **定例会議:**
    *   デイリースクラム (毎日15分)
    *   スプリントプランニング (スプリント開始時、2-4時間)
    *   スプリントレビュー (スプリント終了時、1-2時間)
    *   スプリントレトロスペクティブ (スプリント終了時、1-1.5時間)
    *   プロジェクト進捗会議 (週次、プロジェクトマネージャーとステークホルダー)
*   **報告:**
    *   スプリントごとの進捗報告書
    *   課題・リスク管理表の共有
*   **使用ツール:** Slack, メール, ビデオ会議システム

### 9. 品質管理計画

*   **コードレビュー:** 全てのコード変更に対して、チーム内でのレビューを必須とする。
*   **静的コード解析:** リンター、静的解析ツールを導入し、コーディング規約遵守と潜在バグの早期発見を目指す。
*   **テストカバレッジ:** 単体テストのカバレッジ目標を設定 (例: 70%以上)。
*   **バグトラッキング:** 発見されたバグは全て管理ツールに登録し、修正状況を追跡する。
*   **受け入れ基準:** 各機能の受け入れ基準を明確にし、スプリントレビューで確認する。

### 10. リスク管理計画

| リスク項目                                   | 発生可能性 | 影響度 | 対応策・軽減策                                                                                               | 担当者       |
| -------------------------------------------- | -------- | ---- | ---------------------------------------------------------------------------------------------------------- | ---------- |
| Amazon KindleのWebサイト/API仕様変更による機能停止 | 高       | 大    | 定期的な監視、柔軟なスクレイピングロジックの設計、迅速な修正体制、ユーザーへの事前通知。場合によっては代替手段の調査。                               | テックリード   |
| Google APIの仕様変更・利用制限                 | 中       | 中    | APIドキュメントの定期確認、API利用量のモニタリング、エラーハンドリングの強化。                                                              | バックエンドチーム |
| 認証トークンの漏洩・不正利用                     | 低       | 甚大   | 強力な暗号化、セキュアな保存、アクセス制御の徹底、定期的なセキュリティ監査。                                                                  | テックリード   |
| スクレイピング行為によるAmazonアカウントの制限     | 中       | 大    | 過度なアクセスを避ける、User-Agent設定、エラー時の自動停止・通知機能、Amazonの利用規約遵守。                                                   | バックエンドチーム |
| 開発メンバーの離脱                              | 低       | 中    | ドキュメント整備の徹底、知識共有の促進、ペアプログラミングの導入、引き継ぎ計画。                                                                  | PM         |
| スケジュール遅延                               | 中       | 中    | バッファの確保、進捗の可視化、課題の早期発見と対応、優先順位の見直し。                                                                        | PM         |
| AIリーダブルなMarkdown構造の定義が不明確         | 中       | 中    | 具体的なAIユースケースを想定し、構造を早期にFIXする。サンプルファイルを作成し関係者でレビュー。                                                    | PM, テックリード |
| Dockerイメージの脆弱性混入                   | 中       | 中    | ベースイメージの定期的な更新、脆弱性スキャンツールの導入（例: Trivy, Snyk）、最小権限の原則に従ったDockerfile作成。                                 | テックリード   |
| Google Cloud Runの設定不備による動作不安定     | 中       | 中    | Cloud Runのベストプラクティス学習、十分なテスト、段階的デプロイメント、監視強化。                                                              | テックリード   |
| コンテナレジストリへのアクセス障害               | 低       | 中    | 複数のリージョンへのイメージ保管検討、キャッシュ戦略の活用。                                                                      | バックエンドチーム |

*リスクは定期的に見直し、更新します。*

### 11. リリース計画

*   **リリース判断基準:**
    *   全てのクリティカルなバグが修正されていること。
    *   主要機能が受け入れ基準を満たしていること。
    *   パフォーマンステスト、セキュリティテストが基準値をクリアしていること。
    *   ユーザーマニュアル（簡易版でも可）が準備されていること。
*   **リリース手順:**
    *   最終ビルド、Dockerイメージの作成とテスト。
    *   コンテナイメージをGoogle Artifact Registry（または他の選択されたレジストリ）にプッシュ。
    *   Google Cloud Runに新しいリビジョンとしてデプロイ。
    *   データバックアップ（必要な場合）。
    *   段階的リリース（Cloud Runのトラフィックスプリッティング機能の活用）も検討。
    *   リリース後のモニタリング体制。
*   **ロールバック計画:** 重大な問題発生時の切り戻し手順を準備しておく。（Cloud Runの以前のリビジョンへの迅速なロールバック）

### 12. 保守運用計画（初期フェーズ）
*   リリース後1ヶ月間は、開発チームによる集中サポート期間とする。
*   ユーザーからのフィードバック収集チャネルを設ける。
*   ログ監視、エラー監視体制を確立する。
*   軽微なバグ修正、パフォーマンスチューニングを実施。 